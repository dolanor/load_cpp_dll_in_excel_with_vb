load_cpp_dll_in_excel_with_vb
=============================

As the name say. Just a small tutorial how to create a c++ dll compatible with excel

You need 2 projects : 
* 1 Visual Studio Win32 DLL project
* 1 Excel Worksheet

Visual Studio
-------------
The settings for the project are all default (generated by Visual Studio) except :
* Linker
 * Input
  * Module Definition File : extern.def
 * Advanced
  * Entry Point : DllMain

The C++ source code contains at least 3 functions.
* The function you want to create
* The entry point of the DLL DllMain needed by windows DLL system.
* A Dummy function which is a void function taking no parameters and doing nothing. It is our trick to make Excel load the dll if it is in the same directory. Otherwise, except failure of loading it...

An example code is in **dll.cpp**

Excel
-----
For Excel, we need a little trick for loading the dll from the same folder of the .xls file.
The trick consist of executing a dummy function defined in the dll at the .xls loading

The dummy system is written in **dummy.vb**
The normal call of the function in vb is in **function_call.vb**


// TEMPORARY
dll.cpp
-------
    #include "windows.h"
    #include <cstring>
    
    
    extern "C" 
    {
     __declspec(dllexport) const char* __stdcall stringBack(const char* returnString)
    	{
    		return returnString;
    	}
    
    	__declspec(dllexport) void __stdcall Dummy(){}
    }
    
    
    BOOL WINAPI DllMain(
        HINSTANCE hinstDLL,  // handle to DLL module
        DWORD fdwReason,     // reason for calling function
        LPVOID lpReserved )  // reserved
    {
        // Perform actions based on the reason for calling.
        switch( fdwReason ) 
        { 
            case DLL_PROCESS_ATTACH:
             // Initialize once for each new process.
             // Return FALSE to fail DLL load.
                break;
    
            case DLL_THREAD_ATTACH:
             // Do thread-specific initialization.
                break;
    
            case DLL_THREAD_DETACH:
             // Do thread-specific cleanup.
                break;
    
            case DLL_PROCESS_DETACH:
             // Perform any necessary cleanup.
                break;
        }
        return TRUE;  // Successful DLL_PROCESS_ATTACH.
    }

dummy.vb
--------
    'ThisWorkbook
    Private Declare Sub Dummy Lib "libforexcel.dll" ()
    
    Private Sub Workbook_Open()
      ChDrive ActiveWorkbook.Path
      ChDir ActiveWorkbook.Path
      Dummy
    End Sub

function_call.vb
----------------
    Option Explicit
    Declare Function stringBack Lib "libforexcel.dll" (ByVal thatString As String) As String
    
    Public Function myFunction(ByVal test As String) As String
        Dim st As String
        st = stringBack(test)
        myFunction = st
    End Function
